<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Mis Conversaciones</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  
  <ion-spinner *ngIf="cargando"></ion-spinner>

  <ion-list *ngIf="!cargando">
    <ion-item *ngFor="let c of chatsUsuario" (click)="abrirChat(c)">
      <ion-label>
        <h2>Chat contratación #{{ c.contratacion_id }}</h2>
        <p>Plan ID: {{ c.plan_id }}</p>
        <p>Estado: {{ c.estado }}</p>
      </ion-label>
      <ion-button fill="clear" slot="end">Abrir</ion-button>
    </ion-item>
  </ion-list>

</ion-content>

<!-- MODAL DEL CHAT -->
<ion-modal #chatModal>
  <ng-template>
    
    <ion-header>
      <ion-toolbar color="primary">
        <ion-title>Chat</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="cerrarChat()">Cerrar</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content class="ion-padding">
      <div *ngIf="chatActivo">

        <div *ngIf="otroEscribiendo()" class="typing-indicator">
          El asesor está escribiendo...
        </div>

        <div *ngFor="let m of mensajes" class="mensaje" 
             [class.mio]="m.remitente_id === perfilId">
          <p>{{ m.contenido }}</p>
          <small>{{ m.creado_at | date:'short' }}</small>
        </div>

      </div>
    </ion-content>

    <ion-footer>
      <ion-toolbar>
        <ion-item lines="none">
          <ion-input
            placeholder="Escribe..."
            [(ngModel)]="nuevoMensaje"
            (ionInput)="onTyping()"
            (keyup.enter)="enviar()"
          ></ion-input>
          <ion-button (click)="enviar()">Enviar</ion-button>
        </ion-item>
      </ion-toolbar>
    </ion-footer>

  </ng-template>
</ion-modal>
