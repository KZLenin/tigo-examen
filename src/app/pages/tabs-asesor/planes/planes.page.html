<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Planes móviles</ion-title>

    <ion-buttons slot="end">
      <ion-button (click)="abrirModalCrear()">
        Crear Plan
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <!-- LOADING -->
  <ion-spinner *ngIf="cargando" name="crescent" style="margin: 20px auto; display: block;"></ion-spinner>

  <!-- LISTA DE PLANES -->
  <ion-card *ngFor="let plan of planes">
    <img *ngIf="plan.imagen_url" [src]="plan.imagen_url" />
    
    <ion-card-header>
      <ion-card-title>{{ plan.nombre_comercial }}</ion-card-title>
      <ion-card-subtitle>Precio: ${{ plan.precio }}</ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <p><strong>Segmento:</strong> {{ plan.segmento }}</p>
      <p><strong>Público objetivo:</strong> {{ plan.publico_objetivo }}</p>

      <ion-button expand="block" color="medium" (click)="abrirModalEditar(plan)">
        Editar
      </ion-button>

      <ion-button expand="block" color="danger" (click)="eliminarPlan()">
        Eliminar
      </ion-button>
    </ion-card-content>
  </ion-card>



  <!-- ===========================
        MODAL CREAR / EDITAR PLAN
       =========================== -->
  <ion-modal #planModal>
    <ng-template>
      <ion-header>
        <ion-toolbar color="primary">
          <ion-title>{{ editando ? 'Editar Plan' : 'Crear Plan' }}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="cerrarModal()">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">

        <ion-item>
          <ion-label position="floating">Nombre comercial</ion-label>
          <ion-input [(ngModel)]="form.nombre_comercial"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="floating">Precio</ion-label>
          <ion-input type="number" [(ngModel)]="form.precio"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="floating">Segmento</ion-label>
          <ion-input [(ngModel)]="form.segmento"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="floating">Público objetivo</ion-label>
          <ion-textarea [(ngModel)]="form.publico_objetivo"></ion-textarea>
        </ion-item>

        <ion-item>
          <ion-label position="floating">Descripción</ion-label>
          <ion-textarea [(ngModel)]="form.descripcion"></ion-textarea>
        </ion-item>

        <ion-item>
          <ion-label position="floating">Características (JSON)</ion-label>
          <ion-textarea [(ngModel)]="form.caracteristicas"></ion-textarea>
        </ion-item>

        <ion-item>
          <ion-label>Imagen</ion-label>
          <input type="file" (change)="seleccionarImagen($event)" accept="image/*" />
        </ion-item>

        <img *ngIf="vistaPrevia" [src]="vistaPrevia"
          style="width: 100%; margin-top: 10px; border-radius: 10px;" />

        <ion-button expand="block" color="primary" (click)="guardarPlan()">
          {{ editando ? 'Guardar Cambios' : 'Crear Plan' }}
        </ion-button>

        <ion-button *ngIf="editando" expand="block" color="danger" (click)="eliminarPlan()">
          Eliminar plan
        </ion-button>

      </ion-content>
    </ng-template>
  </ion-modal>

</ion-content>
